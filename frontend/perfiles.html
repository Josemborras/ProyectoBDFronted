<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HomeCinema: Perfiles</title>
    <link rel="stylesheet" href="./css/perfiles.css">
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <div id="go-back">
        <a id="atras" href="./login.html"><img src="./img/flecha-atras-blanca.png" alt=""></a>
    </div>
    <div id="container-global">
        <div id="container-general">
            <p style="font-weight: 600; font-size: 36px;">¿Quién eres? Elige tú perfil</p>
            <div id="container-group">
                <div id="container-perfiles">

                </div>
                <div class="btn-perfil" id="add-btn">
                    <img src="./img/icon-add.png" alt="">
                </div>
            </div>
        </div>
    </div>

    <script>
        const id_usuario = sessionStorage.getItem('userID')
        const addDiv = document.querySelector('#add-btn')
        const containerPerfiles = document.querySelector('#container-perfiles')
        const containerGeneral = document.querySelector('#container-general')
        const containerGlobal = document.querySelector('#container-global')

        fetch('http://localhost:3000/perfiles/usuario/' + id_usuario)
        .then(res => res.json())
        .then(json =>{
            for(let i of json){
                containerPerfiles.innerHTML += `
                <div class="caja-perfil">
                    <div class="btn-perfil" style="background-image: url(${i.url}); background-size: contain; background-position: center; background-repeat: no-repeat"></div>
                    <p>${i.nombre}<p>
                </div>
            `
            }
        })

        fetch(`http://localhost:3000/perfiles/usuario/${id_usuario}/cantidad`)
        .then(res => res.json())
        .then(json =>{
            const data = json[0]
            console.log(data)
            if(data.cantidad_perfiles == data.maximo_perfiles){
                addDiv.style.display = 'none'
            }
        })

        addDiv.addEventListener('click', () =>{
            const atras = document.querySelector('#atras')
            containerGeneral.style.display = 'none'

            containerGlobal.innerHTML += `
            <div style="witdh: 360px; height: 440px; display: flex; flex-direction: column; justify-content: space-between; align-items: center">
                <img id="img-perfil-guardar" class="cursor: point" src="./img/img-camara.png">
                <p class="titular-guardar-perfil">Nombre del perfil</p>
                <input type="text" id="nombre-guardar" placeholder="Introduce el nombre del perfil" autocomplete="off">
                <button>Guardar</button>
            </div>
            `
            atras.setAttribute('href', './perfiles.html')
            const boton = document.querySelector('button')


            boton.addEventListener('click', () =>{

            const nombre = document.querySelector('#nombre-guardar').value
            const foto = document.querySelector('#img-perfil-guardar')

            if(nombre == ''){
                window.location.reload()
            }



            datos = {nombre, id_usuario, id_imagen}

                fetch('http://localhost:3000/perfiles/', {
                    method : 'POST',
                    headers :{
                        'Content-Type' : 'application/json'
                    },
                    body : JSON.stringify(datos)

                })
                    .then( res => {
                        if(res.ok){
                            return res.json()
                        }else{
                            throw new Error('Error en la petición')
                        }
                    })
                    .then(json => console.log('Empleado registrado'))

                    window.location = './perfiles.html'
                    window.location.reload()
            })
        })
    </script>
</body>
</html>