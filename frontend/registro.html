<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HomeCinema: Registro</title>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/registro.css">
</head>
<body>
    <div id="main-container">
        <a href="./login.html"><img src="./img/logo-homecinema.png" alt=""></a>
        <div id="general-container">
            <div id="nav-container">
                <a id="arrow-back" href="./login.html"><img src="./img/flecha-atras.png" alt=""></a>
                <div id="progress-container">
                    <div id="container-progreso">
                        <div class="progreso actual" id="paso1"></div>
                        <div class="progreso" id="paso2"></div>
                        <div class="progreso" id="paso3"></div>
                    </div>
                    <h2 id="pasos">Paso 1</h2>
                    <p id="frase-navigator">Elige el plan que mejor se adapte a ti</p>
                </div>
            </div>
            <div>
                <div id="container-panel">
                    <div id="responsive-planes">
                        <div id="cabeceras">

                        </div>
                        <div class="inner-panel">
                            <p>Precio al mes</p>
                            <p id="responsive-precio"><b>PRECIO</b></p>
                        </div>
                        <hr>
                        <div class="inner-panel">
                            <p>Resolución</p>
                            <p id="responsive-resolucion"><b>RESOLUCIÓN</b></p>
                        </div>
                        <hr>
                        <div class="inner-panel">
                            <p>Anuncios</p>
                            <p id="responsive-anuncios"><b>ANUNCIOS</b></p>
                        </div>
                        <hr>
                        <div class="inner-panel">
                            <p>Número de perfiles</p>
                            <p id="responsive-perfiles"><b>Nº PERFILES</b></p>
                        </div>
                        <hr>
                        <div class="inner-panel">
                            <p>Pantallas simultáneas</p>
                            <p id="responsive-pantallas"><b>Nº PANTALLAS</b></p>
                        </div>
                        <hr>
                        <div class="inner-panel">
                            <p>Descargas</p>
                            <p id="responsive-descargas"><b>DESCARGAS</b></p>
                        </div>
                    </div>
                </div>
    
                <div id="container-inputs">
                    <form>
                        <div class="inner-input">
                            <div class="inputs">
                                <label for="correo">Correo electrónico *</label>
                                <input type="email" name="correo" id="correo" placeholder="Introduce tu correo electrónico" autocomplete="off">
                            </div>
                            <div class="inputs">
                                <label for="nombre">Nombre *</label>
                                <input type="text" name="nombre" id="nombre" placeholder="Introduce tu nombre" autocomplete="off">
                            </div>
                        </div>
                        <div class="inner-input">
                            <div class="inputs">
                                <label for="password">Contraseña *</label>
                                <input type="password" name="password" id="password" placeholder="Introduce tu contraseña" autocomplete="off">
                            </div>
                            <div class="inputs">
                                <label for="apellido_uno">Primer apellido *</label>
                                <input type="text" name="apellido_uno" id="apellido_uno" placeholder="Introduce tu primer apellido" autocomplete="off">
                            </div>
                        </div>
                        <div class="inner-input">
                            <div class="inputs">
                                <label for="repeat-password">Confirmar contraseña *</label>
                                <input type="password" name="repeat-password" id="repeat-password" placeholder="Vuelve a introducir tu contraseña" autocomplete="off">
                            </div>
                            <div class="inputs">
                                <label for="apellido_dos">Segundo apellido</label>
                                <input type="text" name="apellido_dos" id="apellido_dos" placeholder="Introduce tu segundo apellido" autocomplete="off">
                            </div>
                        </div>
                        <!-- <button id="boton-form" type="submit">Siguiente</button> -->
                    </form>
                </div>
                <div id="container-pago">
                    <div class="desplegables">
                        <input class="radio-pago" type="radio" name="pago">
                        <div class="inner-pago">
                            <div style="display: flex; flex-direction: column; justify-content: space-between; height: 42px; margin-right: 50px;">
                                <img src="./img/icon-visa.png" alt="">
                                <img src="./img/icon-mastercard.png" alt="">
                            </div>
                            <p>Tarjeta de crédito/débito</p>
                        </div>
                    </div>
                    <div class="desplegables">
                        <input class="radio-pago" type="radio" name="pago">
                        <div class="inner-pago">
                            <img style="height: 42px; margin-right: 50px;" src="./img/icon-paypal.png" alt="">
                            <p>PayPal</p>
                        </div>
                    </div>
                    <div class="desplegables">
                        <input class="radio-pago" type="radio" name="pago">
                        <div class="inner-pago">
                            <img src="./img/icon-regalo.png" style="margin-right: 50px;" alt="">
                            <p>Tarjeta regalo</p>
                        </div>
                    </div>
                </div>
            </div>
            <button id="boton-general" type="submit">Siguiente</button>
        </div>
    </div>

    <script>
        const contenedorPago = document.querySelector('#container-pago')
        const contenedorPanel = document.querySelector('#container-panel')
        const contenedorInputs = document.querySelector('#container-inputs')
        const pasos = document.querySelector('#pasos')
        const paso1 = document.querySelector('#paso1')
        const paso2 = document.querySelector('#paso2')
        const paso3 = document.querySelector('#paso3')
        let pagina  = 1
        const botonFrom = document.querySelector('#boton-general')
        const boton = document.querySelector('#boton-general')
        const flechaAtras = document.querySelector('#arrow-back')
        const nombre = document.querySelector('#nombre')
        const apellido_uno = document.querySelector('#apellido_uno')
        const apellido_dos = document.querySelector('#apellido_dos')
        const correo = document.querySelector('#correo')
        const password = document.querySelector('#password')
        const repeatPassword = document.querySelector('#repeat-password')
        const frase = document.querySelector('#frase-navigator')
        const form = document.querySelector('form')


        fetch('http://localhost:3000/planes')
            .then(res => res.json())
            .then(json => {
                const cabeceraCalidad = document.querySelector('.cabecera-calidad-plan')
                const resolucion = document.querySelector('.resolucion-plan')
                const anuncios = document.querySelector('.anuncios-plan')
                const descargas = document.querySelector('.descargas-plan')

                if(window.innerWidth < 1024 && window.innerWidth >= 768){
                    const cabeceras = document.querySelector('#cabeceras')
                    for(let i = 2; i>=0 ; --i){
                        cabeceras.innerHTML += `
                    <div onClick="ingresarDatos(${json[i].id}); getId(${json[i].id}); setDatos(${i})" id="id${i}">
                        <div class="cabecera" id="cabecera${i}">
                            <h3>${json[i].nombre}</h3>
                            <div style="display:flex;flex-direction:row;width:100%;justify-content:space-between; max-height: 18px">
                                <p class="cabecera-calidad-plan">${calidadesCabecera(json[i].calidad)}</p>
                                <img class="display-img" src="  ./img/tick.png" style="height: 24px; width: 24px; position:relative; top: 30px">
                            </div>
                        </div>
                    </div>
                    `
                    }

                    cons = setDatos = (i) =>{
                        document.querySelector('#responsive-precio').innerHTML = `<b>${json[i].precio}€</b>`
                        document.querySelector('#responsive-resolucion').innerHTML = `<b>${calidadResolucion(json[i].calidad)}</b>`
                        document.querySelector('#responsive-pantallas').innerHTML = `<b>${json[i].num_pantalla}</b>`
                        document.querySelector('#responsive-perfiles').innerHTML = `<b>${json[i].numero_perfiles}</b>`
                        document.querySelector('#responsive-descargas').innerHTML = `<b>${checkBooleanos(json[i].descargas)}</b>`
                        document.querySelector('#responsive-anuncios').innerHTML = `<b>${checkBooleanos(json[i].anuncios)}</b>`
                    }
                }

                if(window.innerWidth >= 1024){
                    console.log(window.innerWidth)
                    for(let i = 2; i>=0 ; --i){
                    contenedorPanel.innerHTML += `
                    <div class="panel" onClick="ingresarDatos(${json[i].id}); getId(${json[i].id})" id="id${i}">
                        <div class="cabecera" id="cabecera${i}">
                            <h3>${json[i].nombre}</h3>
                            <div style="display:flex;flex-direction:row;width:100%;justify-content:space-between; max-height: 18px">
                                <p class="cabecera-calidad-plan">${calidadesCabecera(json[i].calidad)}</p>
                                <img class="display-img" src="  ./img/tick.png" style="height: 24px; width: 24px">
                            </div>
                        </div>
                        <div class="inner-panel">
                            <p>Precio al mes</p>
                            <p>${json[i].precio}€</p>
                            <hr>
                        </div>
                        <div class="inner-panel">
                            <p>Resolución</p>
                            <p class="resolucion-plan">${calidadResolucion(json[i].calidad)}</p>
                            <hr>
                        </div>
                        <div class="inner-panel">
                            <p>Anuncios</p>
                            <p class="anuncios-plan">${checkBooleanos(json[i].anuncios)}</p>
                            <hr>
                        </div>
                        <div class="inner-panel">
                            <p>Número de perfiles</p>
                            <p class="perfiles-plan">${json[i].numero_perfiles}</p>
                            <hr>
                        </div>
                        <div class="inner-panel">
                            <p>Pantallas simultáneas</p>
                            <p class="pantallas-plan">${json[i].num_pantalla}</p>
                            <hr>
                        </div>
                        <div class="inner-panel">
                            <p>Descargas</p>
                            <p class="descargas-plan">${checkBooleanos(json[i].descargas)}</p>
                        </div>
                    </div>
                `
                }

                }

            })

            const isClicked = (id) =>{
                switch(id){
                }
            }
            
            boton.addEventListener('click', (e) =>{
                if(pagina == 2){
                }else{
                    e.preventDefault()
                }
                avanzarPaso()
            })

            const calidadResolucion = (dato) =>{
                switch(dato){
                        case 1:
                            return "1280 x 720 (720p)"
                            break
                        case 2:
                            return "1920 x 1080 (1080p)"
                        case 3:
                            return "3840 x 2160 (4K)"
                        default:
                            return
                    }
            }

            const calidadesCabecera = (dato) =>{
                switch(dato){
                        case 1:
                            return "720p"
                        case 2:
                            return "1080p"
                        case 3:
                            return "4K"
                        default:
                            return
                            
                    }
            }

            const checkBooleanos = (dato) =>{
                if(dato == 1){
                        return "Sí"
                    }else{
                        return "No"
                    }
            }

            const checkPagina = (pag, item) =>{
                switch (pag){
                    case 1:
                        item.innerHTML = 'Elige el plan que mejor se adapte a ti'
                        break
                    case 2:
                        item.innerHTML = `¡Ya casi estamos! Rellena los siguientes campos para completar tu registro`
                        break
                    case 3:
                        console.log("patata")
                        item.innerHTML = `Método de pago`
                        break
                    default:
                        break
                }
            }
            
            const ingresarDatos = (id) => {
                sessionStorage.setItem('planId', id)
            }

            const getId = (id) =>{
                if(window.innerWidth < 1024 && window.innerWidth >= 768){
                    id = 3-id
                let planes = document.getElementsByClassName('cabecera')
                let imagen = planes[id].querySelector('img')
                for(let i = 0; i < planes.length; ++i){
                    if(i == id){
                        planes[i].style.boxShadow = "0px 0px 8px #00000080"
                        planes[i].querySelector('img').classList.remove("display-img")
                    }else{
                        planes[i].style.boxShadow = "none"
                        planes[i].querySelector('img').classList.add("display-img")
                    }
                }
                }
                if(window.innerWidth >= 1024){
                    id = 3-id
                let planes = document.getElementsByClassName('panel')
                let imagen = planes[id].querySelector('img')
                for(let i = 0; i < planes.length; ++i){
                    if(i == id){
                        planes[i].style.boxShadow = "0px 0px 8px #00000080"
                        planes[i].querySelector('img').classList.remove("display-img")
                    }else{
                        planes[i].style.boxShadow = "none"
                        planes[i].querySelector('img').classList.add("display-img")
                    }
                }
                }
            }

            const refreshPagina = () =>{
                switch(pagina){
                    case 1:
                    setClase(paso1, 'actual')
                    break
                    case 2:
                    contenedorPanel.style.display = 'none'
                    contenedorInputs.style.display = 'flex'
                    setClase(paso1, 'completado')
                    deleteClass(paso1, 'actual')
                    setClase(paso2, 'actual')
                    boton.addEventListener('click', () =>{
                    sessionStorage.setItem('nombre', nombre.value)
                    sessionStorage.setItem('apellido_uno', apellido_uno.value)
                    sessionStorage.setItem('apellido_dos', apellido_dos.value)
                    sessionStorage.setItem('correo', correo.value)
                    sessionStorage.setItem('password', password.value)
                    })
                    break

                    case 3:
                    contenedorPanel.style.display = 'none'
                    contenedorInputs.style.display = 'none'
                    setClase(paso2, 'completado')
                    deleteClass(paso2, 'actual')
                    setClase(paso3, 'actual')
                    contenedorPago.style.display = 'flex'
                    break
                    case 4:
                        --pagina
                        const datos = {
                            nombre : sessionStorage.getItem('nombre'),
                            apellido_uno : sessionStorage.getItem('apellido_uno'),
                            apellido_dos : sessionStorage.getItem('apellido_dos'),
                            correo : sessionStorage.getItem('correo'),
                            password : sessionStorage.getItem('password'),
                            id_plan : sessionStorage.getItem('planId')  
                        }

                        guardarUsuario(datos)
                        sessionStorage.clear()

                        window.location = './login.html'
                    break
                    default: break
                }
                if(pagina <=3){
                    pasos.innerHTML = `
                Paso ${pagina}
                `

                checkPagina(pagina, frase)
                }
            }

            const avanzarPaso = () =>{

                if(pagina <= 4){
                    ++pagina
                }

                if(pagina == 2){
                    if(sessionStorage.getItem('planId') == '' || sessionStorage.getItem('planId') == null){
                        pagina = 1
                        alert('Selecciona un plan')
                    }
                }

                if(pagina == 3){
                    if((nombre.value == '' || nombre.value == null) || correo.value == '' || correo.value == null ||apellido_uno == '' || apellido_uno == null || password.value == '' || password.value == null){
                        pagina = 2
                        alert('Por favor rellena todos los campos marcados con un (*)')
                    }else if(password.value != repeatPassword.value){
                        alert('Las contraseñas no son iguales')
                        pagina = 2
                    }else if(!validarEmail(correo.value)) {
                        alert("La dirección de correo electrónico no es válida.");
                        pagina = 2
                    }
                }

                pasos.innerHTML = `
                Paso ${pagina}
                `

                refreshPagina()
            }

            form.addEventListener('submit', (e) =>{
                e.preventDefault()
            })

            const guardarUsuario = (datos) => {
                fetch('http://localhost:3000/registro', {
                    method : 'POST',
                    headers :{
                        'Content-Type' : 'application/json'
                    },
                    body : JSON.stringify(datos)

                })
                    .then( res => {
                        if(res.ok){
                            return res.json()
                        }else{
                            throw new Error('Error en la petición')
                        }
                    })
                    .then(json => console.log('Empleado registrado'))
            }

            const retrocederPaso = () =>{
                if(pagina >= 1){
                    --pagina
                    checkPagina(pagina, frase)
                }
                if(pagina != 0){
                    pasos.innerHTML = `
                Paso ${pagina}
                `
                }

                switch(pagina){
                    case 0:
                    window.location = './login.html'
                    break
                    
                    case 1:
                    contenedorPanel.style.display = 'flex'
                    contenedorInputs.style.display = 'none'
                    setClase(paso1, 'actual')
                    deleteClass(paso2, 'actual')
                    deleteClass(paso2, 'completado')
                    break

                    case 2:
                    contenedorPanel.style.display = 'none'
                    contenedorInputs.style.display = 'flex'
                    setClase(paso1, 'completado')
                    deleteClass(paso1, 'actual')
                    setClase(paso2, 'actual')
                    deleteClass(paso3, 'actual')
                    contenedorPago.style.display = 'none'
                    break

                    case 3:
                    contenedorPanel.style.display = 'none'
                    contenedorInputs.style.display = 'none'
                    setClase(paso2, 'completado')
                    deleteClass(paso2, 'actual')
                    setClase(paso3, 'actual')   
                    break

                    default: break
                }
            }

            const validarEmail = (email) =>{
                // Expresión regular para validar un email
                var patron = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/
                return patron.test(email)
            }

            const setClase = (actual, clase) =>{
                actual.classList.add(clase)
            }

            const deleteClass = (actual, eliminar) =>{
                actual.classList.remove(eliminar)
            }

            flechaAtras.addEventListener('click', (e) =>{
                e.preventDefault()

                retrocederPaso()
            })
    </script>
</body>
</html>